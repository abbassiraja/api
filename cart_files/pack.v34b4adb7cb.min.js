function clicChildren(){$("#searchForm .rooms > div").each(function(a){var b=parseInt(a+1);for(children=$("#children_"+b).val(),e=1;e<=3;e++)id="age_"+e+"_"+b,$el=$("select#"+id).attr("name"),e<=children?$("select#"+id).parent().show():$("select#"+id).parent().hide();$("#searchForm select[id^='age_']").each(function(a){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),$("#searchForm select[id^='age_']:visible").each(function(a){$n=$(this).attr("name"),$("#searchForm").formValidation("addField",$n,{validators:{notEmpty:{message:"Obligatoire!"}}}),console.log("add formvalidation to : "+$n)})})}function countGuest(){var a=0,b=0,c=0,d=$('input[name="rooms"]').val();$("#searchForm .adultshotel").each(function(b,c){a+=parseInt($(this).val())}),$("#searchForm .childrenhotel").each(function(a,c){b+=parseInt($(this).val())}),$("#searchForm .infantshotel").each(function(a,b){c+=parseInt($(this).val())}),$("#searchForm .guests-select .valRoomstshotel").html(d),$("#searchForm .guests-select .valAdultshotel").html(a),b>0?$("#searchForm .guests-select .valChildrenhotel").html(", "+b):$("#searchForm .guests-select .valChildrenhotel").html(""),c>0?$("#searchForm .guests-select .valInfantshotel").html(", "+c):$("#searchForm .guests-select .valInfantshotel").html(""),1==d?$("#searchForm .guests-select .txt-room").html("chambre"):$("#searchForm .guests-select .txt-room").html("chambres"),a>1?$("#searchForm .guests-select .txt-adt").html("adultes"):$("#searchForm .guests-select .txt-adt").html("adulte"),b>1?$("#searchForm .guests-select .txt-enf").html("enfants"):0==b?$("#searchForm .guests-select .txt-enf").html(""):$("#searchForm .guests-select .txt-enf").html("enfant"),c>1?$("#searchForm .guests-select .txt-beb").html("b&eacute;b&eacute;s"):0==c?$("#searchForm .guests-select .txt-beb").html(""):$("#searchForm .guests-select .txt-beb").html("b&eacute;b&eacute;")}function delRoom(){$("#searchForm select[id^='age_']").each(function(a){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),$("#searchForm .rooms > div").each(function(a){$(this).find("div:eq(0) label").html("Chambre "+parseInt(a+1)),$(this).find("button").each(function(){$(this).attr({"data-field":function(b,c){return Left(c,c.length-1)+parseInt(a+1)}}).removeAttr("disabled")}),$(this).find("#searchForm input[type='text']").each(function(){$(this).attr({id:function(b,c){return Left(c,c.length-1)+parseInt(a+1)},name:function(b,c){return Left(c,c.length-1)+parseInt(a+1)}}),parseInt(a+1)>1&&$(this).attr("min",0)}),$(this).find("#searchForm select").each(function(){$(this).attr({id:function(b,c){return Left(c,c.length-1)+parseInt(a+1)},name:function(b,c){return Left(c,c.length-1)+parseInt(a+1)}})}),$(this).find("#searchForm small").each(function(){$(this).attr({"data-fv-for":function(b,c){return Left(c,c.length-1)+parseInt(a+1)}})})});var a=$("#searchForm .rooms > div").length;$("#searchForm input[name=rooms]").val(a),a<4&&$("#searchForm a.add").show()}function addRoom(){var a=$("#searchForm .rooms > div").length;a++;var b=$("#searchForm .rooms > div:last-child"),c=$("#searchForm .rooms > div:eq(0)").clone(!0);c.find("button").each(function(){$(this).attr({"data-field":function(b,c){return Left(c,c.length-1)+a}}).removeAttr("disabled")}),c.find("input[type='text']").each(function(){$(this).attr({id:function(b,c){return Left(c,c.length-1)+a},name:function(b,c){return Left(c,c.length-1)+a}}),a>1&&$(this).attr("min",0)}),c.find("select").each(function(){$(this).attr({id:function(b,c){return Left(c,c.length-1)+a},name:function(b,c){return Left(c,c.length-1)+a}})}),c.find("small").each(function(){$(this).attr({"data-fv-for":function(b,c){return Left(c,c.length-1)+a}})}),c.insertAfter(b);var d=$("#searchForm .rooms > div").length;$("#searchForm .rooms > div").each(function(a){$(this).find("div:eq(0) label").html("Chambre "+parseInt(a+1))}),$("#searchForm input[name=rooms]").val(d),4==d&&$("#searchForm a.add").hide(),clicChildren(),countGuest(),$("#searchForm .rooms div:first").find("div.delete-room").find("a").hide(),$("#searchForm .rooms div:gt(1)").find("div.delete-room").find("a").show(),$("#searchForm a.del").click(function(){row_id=$(this).parent().parent(),row_id.remove(),delRoom(),clicChildren(),countGuest()})}if(void 0===versionNumber||null===versionNumber)var versionNumber=(new Date).getTime();$(function(){function a(a,c){""==a?c(b.all()):b.search(a,c)}$("#searchForm .rooms div:first").find("div.delete-room").find("a").hide(),$("#searchForm a.add").click(function(){addRoom()}),$("#searchForm .adultshotel,#searchForm .childrenhotel,#searchForm .infantshotel").bind("change",function(){countGuest()}).change(),$("#searchForm .childrenhotel").bind("change",function(){clicChildren()}).change(),$("#searchForm a.del").click(function(){$("select[id^='age_']").each(function(a){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),row_id=$(this).parent().parent(),row_id.remove(),delRoom(),clicChildren(),countGuest()}),$("#searchForm .guests-select").click(function(){$("#searchForm .guests").show()}),$("#searchForm .button-save, #searchForm .closef").click(function(){$("#searchForm .guests").fadeOut()});var b=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("city"),queryTokenizer:Bloodhound.tokenizers.whitespace,identify:function(a){return a.city},prefetch:"/hotels/data/destinations.json?v=2.0"}),c=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("label"),queryTokenizer:Bloodhound.tokenizers.whitespace,initialize:!1,remote:{url:"/hotels/data/destinations.cfm?query=%QUERY",wildcard:"%QUERY"}}),d=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("label"),queryTokenizer:Bloodhound.tokenizers.whitespace,initialize:!1,remote:{url:"/hotels/data/hotels.cfm?query=%QUERY",wildcard:"%QUERY"}});$("#searchForm #locality").typeahead({minLength:0,highlight:!0},{name:"destination",display:"label",limit:20,minLength:0,source:a,templates:{header:'<div class="bg-auto-subtitle"><h5 class="mb-0">Top destinations</h5></div>',suggestion:function(a){return'<div class="tt-suggest-page"><i class="fa fa-map-marker-alt text-secondary" aria-hidden="true"></i> &nbsp; '+a.label+"</div>"}}},{name:"destination",display:"label",minLength:3,limit:300,source:c,templates:{header:'<div class="bg-auto-subtitle"><h5 class="mb-0">Villes</h5></div>',suggestion:function(a){return'<div class="tt-suggest-page"><i class="fa fa-map-marker-alt text-secondary" aria-hidden="true"></i> &nbsp; '+a.label+"</div>"}}},{name:"destination",display:"label",minLength:3,limit:300,source:d,templates:{header:'<div class="bg-auto-subtitle"><h5 class="mb-0">Hôtels</h5></div>',suggestion:function(a){return'<div class="tt-suggest-page"><i class="fa fa-bed text-secondary" aria-hidden="true"></i> &nbsp; '+a.label+"</div>"}}}).on("typeahead:asyncrequest",function(){$(".Typeahead-spinner").show()}).on("typeahead:asynccancel typeahead:asyncreceive",function(){$(".Typeahead-spinner").hide()}).bind("typeahead:selected",function(a,b,c){$("#searchForm #destinationId").val(b.code),$("#searchForm #hotelId").val(b.hotelCode),$("#searchForm").formValidation("revalidateField","locality"),$(".icon-close").show(),$("#arrDate").trigger("click")}),$(".icon-close").click(function(){$("#searchForm #locality").typeahead("val",""),$(this).hide()});var e,f,g=new Date,h=moment(g).subtract({days:0}).toDate(),i=moment(g).add({days:360}).toDate(),j={previousMonth:"Mois précédent",nextMonth:"Mois prochain",months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdays:["dimanche"," lundi "," mardi "," mercredi "," jeudi "," vendredi "," samedi "],weekdaysShort:["Dim","Mon","Mar","Mer","Jeu","Ven","Sam"]},k=function(){startPicker.setStartRange(e),_startDate=moment(e).add({days:1}).toDate(),endPicker.setStartRange(_startDate),endPicker.setMinDate(_startDate),endPicker.gotoDate(_startDate)},l=function(){startPicker.setEndRange(f),endPicker.setEndRange(f)};$("#searchForm .arrDate").each(function(a,b){startPicker=new Pikaday({labelMonthSelect:"Pick a month from the dropdown",labelYearSelect:"Pick a year from the dropdown",selectMonths:!0,selectYears:!0,numberOfMonths:2,i18n:j,field:b,format:"DD/MM/YYYY",formatSubmit:"DD/MM/YYYY",minDate:h,maxDate:i,onSelect:function(){e=this.getDate(),k(),_Endvar=this.getMoment().add(1,"days").format("DD/MM/YYYY"),$("#searchForm .depDate").val(_Endvar),endPicker.show(),$(".nights-count").val("1 nuit")}})}),$("#searchForm .depDate").each(function(a,b){endPicker=new Pikaday({numberOfMonths:2,i18n:j,field:b,selectMonths:!0,selectYears:!0,format:"DD/MM/YYYY",formatSubmit:"DD/MM/YYYY",minDate:h,onSelect:function(){f=this.getDate(),l()}})}),_startDate=startPicker.getDate(),_endDate=endPicker.getDate(),_startDate&&(e=_startDate,k()),_endDate&&(f=_endDate,l()),$("#arrDate,#depDate").on("change",function(){if(""!=$("#depDate").val()&&""!=$("#arrDate").val()){var a=$("#depDate").val().split("/"),b=$("#arrDate").val().split("/"),c=a[1]-1,d=b[1]-1,e=new Date(a[2],c,a[0]),f=new Date(b[2],d,b[0]),g=Math.abs(f.getTime()-e.getTime()),h=Math.ceil(g/864e5);console.log(h),1==h?$(".nights-count").val(h+" nuit"):$(".nights-count").val(h+" nuits")}}),$("#arrDate").on("focus",function(){$(".guests").hide()}),$("#depDate").on("focus",function(){$(".guests").hide()}),$("#searchForm").formValidation({message:"Veuillez remplir ce champs",excluded:"",live:"disabled",verbose:"false",fields:{locality:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}},arrDate:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}},depDate:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}}}}).on("err.form.fv",function(a,b){$p=$("#searchForm .persons").find("[data-fv-validator][data-fv-result='INVALID']").length,$p>0&&$("#searchForm .guests").show()})});